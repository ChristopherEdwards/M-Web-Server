 #  Copyright 2019 Christopher Edwards
 # 
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 # 
 #     http://www.apache.org/licenses/LICENSE-2.0
 # 
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.

# Disable warnings generated by the compiler
# This must be before the CMAKE_MODULE_PATH as it changes a default setting
set(MUMPS_NOWARNING ON CACHE BOOL "" FORCE)

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/ydbcmake/")

project(MWebServer C MUMPS)
cmake_minimum_required(VERSION 2.8)

# Find YottaDB
find_package(YOTTADB REQUIRED)
include_directories("${YOTTADB_INCLUDE_DIRS}")

set(ydb_install_dir ${YOTTADB_INCLUDE_DIRS}/plugin)

# Add commands to compile .m files
add_library(_ydbmwebserver SHARED
  src/_WC.m
  src/_webapi.m
  src/_webhome.m
  src/_webjson.m
  src/_webjsonDecode.m
  src/_webjsonEncode.m
  src/_webreq.m
  src/_webrsp.m
  src/_webutils.m
)

SET_TARGET_PROPERTIES(_ydbmwebserver PROPERTIES PREFIX "")

install(FILES
  src/_WC.m
  src/_webapi.m
  src/_webhome.m
  src/_webjson.m
  src/_webjsonDecode.m
  src/_webjsonEncode.m
  src/_webreq.m
  src/_webrsp.m
  src/_webutils.m
  DESTINATION ${ydb_install_dir}/r/
)

if(MUMPS_UTF8_MODE)
  install(FILES ${CMAKE_CURRENT_BINARY_DIR}/_ydbmwebserver.so
    DESTINATION ${ydb_install_dir}/o/utf8
  )
else()
  install(FILES ${CMAKE_CURRENT_BINARY_DIR}/_ydbmwebserver.so
    DESTINATION ${ydb_install_dir}/o/
  )
endif()
